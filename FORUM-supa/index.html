<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zine Wall</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Space+Mono&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>ðŸ–¤ ZINE WALL</h1>

  <!-- Dark Mode Toggle -->
  <button id="toggle">ðŸ–¤ Dark Zine Mode</button>

  <!-- AUTH -->
  <div id="auth">
    <input id="email" type="email" placeholder="email" />
    <input id="password" type="password" placeholder="password" />
    <button onclick="handleSignUp()">Sign Up</button>
    <button onclick="logIn()">Log In</button>
  </div>

  <!-- FORUM -->
  <div id="forum" hidden>
    <p id="user"></p>

    <input id="title" placeholder="post title" />
    <textarea id="content" rows="4" placeholder="paste your thoughts here..."></textarea>
    <button onclick="addPost()">POST</button>

    <div id="wall"></div>
  </div>

  <!-- âœ… SIGNUP SUCCESS MODAL -->
  <div id="signupModal" class="modal">
    <div class="modal-content">
      <h2>YOUâ€™RE IN ðŸ–¤</h2>
      <p>Welcome to the zine wall,</p>
      <p><strong id="modalUser"></strong></p>
      <p>Youâ€™re officially part of the forum.</p>
      <button id="closeModal">Enter the Wall</button>
    </div>
  </div>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Dark Mode Script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("toggle");
      toggle.onclick = () => document.body.classList.toggle("dark");
    });
  </script>

  <!-- MAIN SCRIPT -->
  <script type="module">
    // =========================
    // SUPABASE SETUP
    // =========================
    const supabaseUrl = "YOUR_SUPABASE_URL";
    const supabaseKey = "YOUR_ANON_PUBLIC_KEY";
    const supabase = supabaseJs.createClient(supabaseUrl, supabaseKey);

    // =========================
    // DOM
    // =========================
    const authDiv = document.getElementById("auth");
    const forum = document.getElementById("forum");
    const userText = document.getElementById("user");
    const wall = document.getElementById("wall");

    // Modal
    const modal = document.getElementById("signupModal");
    const modalUser = document.getElementById("modalUser");
    const closeModal = document.getElementById("closeModal");

    // =========================
    // SIGN UP (WITH MODAL)
    // =========================
    window.handleSignUp = async function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { data, error } = await supabase.auth.signUp({
        email,
        password
      });

      if (error) {
        alert(error.message);
        return;
      }

      // Show success modal
      modalUser.textContent = email;
      modal.style.display = "flex";
    };

    closeModal.onclick = () => {
      modal.style.display = "none";
    };

    // =========================
    // LOGIN
    // =========================
    window.logIn = async function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) alert(error.message);
    };

    // =========================
    // AUTH STATE
    // =========================
    supabase.auth.onAuthStateChange((event, session) => {
      if (session?.user) {
        authDiv.hidden = true;
        forum.hidden = false;
        userText.textContent = "Logged in as " + session.user.email;
        loadPosts();
      } else {
        authDiv.hidden = false;
        forum.hidden = true;
        userText.textContent = "";
      }
    });

    // =========================
    // POSTS
    // =========================
    window.addPost = async function () {
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      const { data: userData } = await supabase.auth.getUser();

      if (!title || !content) return;

      await supabase.from("posts").insert({
        title,
        content,
        user_email: userData.user.email
      });

      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
    };

    async function loadPosts() {
      const { data } = await supabase
        .from("posts")
        .select("*")
        .order("inserted_at", { ascending: false });

      wall.innerHTML = "";
      data.forEach(post => {
        const card = document.createElement("div");
        card.className = "card";
        card.style.transform = `rotate(${Math.random() * 4 - 2}deg)`;

        card.innerHTML = `
          <div class="sticker">ZINE</div>
          <h3>${post.title}</h3>
          <p>${post.content}</p>
          <small>${post.user_email}</small>
        `;
        wall.appendChild(card);
      });
    }
  </script>

</body>
</html>
