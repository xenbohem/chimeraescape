<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hans’ Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg-indigo: #0f0b24;
  --panel-purple: rgba(60, 40, 110, 0.45);
  --lavender: #e7dcff;
  --violet-glow: rgba(190, 140, 255, 0.6);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #1b1440, var(--bg-indigo));
  color: var(--lavender);
  font-family: "Georgia", serif;
  height: 100vh;
  overflow: hidden;
}

/* Layout */
.app-shell {
  display: grid;
  grid-template-columns: 260px 1fr 300px;
  height: 100%;
}

/* Drawers */
.drawer {
  padding: 20px;
  background: var(--panel-purple);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  box-shadow: inset 0 0 40px rgba(255,255,255,0.05),
              0 0 30px rgba(120,90,255,0.25);
}

/* Titles */
.drawer-left h3, .drawer-right h3 {
  letter-spacing: 0.15em;
  text-transform: uppercase;
  font-size: 12px;
  opacity: 0.8;
}

/* Library Buttons */
.book-category {
  display: block;
  width: 100%;
  margin-top: 14px;
  padding: 10px;
  border-radius: 14px;
  border: none;
  background: rgba(180,150,255,0.15);
  color: var(--lavender);
  cursor: pointer;
  backdrop-filter: blur(6px);
}

.book-category:hover {
  box-shadow: 0 0 12px var(--violet-glow);
}

/* Reading Room */
.reading-room {
  padding: 48px;
  overflow-y: auto;
}
.reading-room h1 { font-weight: normal; }

/* Listening Room */
.now-listening {
  margin-top:20px;
  padding:14px;
  border-radius:16px;
  background: rgba(100,80,160,0.25);
  backdrop-filter: blur(12px);
  box-shadow: 0 0 18px var(--violet-glow);
  transition: box-shadow 0.1s ease;
}
#trackTitle { display: block; font-size: 14px; }
.hans-note { font-size: 13px; opacity: 0.75; margin-top: 6px; }
.hans-button {
  margin-top: 18px;
  width: 100%;
  padding: 12px;
  border-radius: 16px;
  border: none;
  background: rgba(200,170,255,0.2);
  color: white;
  cursor: pointer;
}
.hans-button:hover { box-shadow: 0 0 20px var(--violet-glow); }

/* Center Video Reveal */
.video-reveal {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 60%; max-width: 800px;
  border-radius: 20px;
  overflow: hidden;
  backdrop-filter: blur(14px);
  box-shadow: 0 0 40px rgba(190,140,255,0.5);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
  z-index: 1000;
}
.video-reveal.active { opacity: 1; pointer-events: auto; }
.video-reveal video { width: 100%; height: auto; display: block; }
.close-video {
  position: absolute; top: 12px; right: 12px;
  background: rgba(200,170,255,0.3);
  border: none; border-radius: 12px;
  color: #fff; font-size: 18px; cursor: pointer;
}

/* Marginalia */
.marginalia { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events: none; overflow: hidden; z-index:900; }
.marginalia-note {
  position: absolute;
  font-family: "Georgia", serif;
  color: #e7dcff;
  font-size: 14px;
  opacity: 0.85;
  white-space: nowrap;
  pointer-events: none;
  animation: floatNote 12s linear forwards;
}
@keyframes floatNote {
  0% { transform: translateY(100vh) rotate(-5deg); opacity:0; }
  20% { opacity:0.8; }
  80% { opacity:0.8; }
  100% { transform: translateY(-50px) rotate(5deg); opacity:0; }
}
.marginalia-input {
  position: fixed; bottom:24px; left:50%; transform:translateX(-50%);
  display:flex; gap:8px; z-index:950;
}
.marginalia-input input {
  padding:8px 12px; border-radius:12px; border:none;
  width:220px;
  backdrop-filter: blur(6px);
  background: rgba(100,80,160,0.25);
  color: #e7dcff;
}
.marginalia-input button {
  padding:8px 12px; border-radius:12px; border:none;
  background: rgba(200,170,255,0.3);
  color: #fff; cursor:pointer;
}

/* Mobile */
@media (max-width: 900px) {
  .app-shell { grid-template-columns:1fr; }
  .drawer { display:none; }
}
</style>
</head>

<body>
<div class="app-shell">

  <!-- Library -->
  <aside class="drawer drawer-left">
    <h3>Library</h3>
    <button class="book-category" data-mood="winter">Gothic & Winter</button>
    <button class="book-category" data-mood="Noon">Noon Tea</button>
    <button class="book-category" data-mood="evening">Cozy Fantasy</button>
    <button class="book-category" data-mood="quiet">Poetry & Reflection</button>
  </aside>

  <!-- Main Reading Area -->
  <main class="reading-room">
    <h1>The Library</h1>
    <p>Shelves rest in violet shadow. Hans does not rush you.</p>
  </main>

  <!-- Listening Room -->
  <aside class="drawer drawer-right">
    <h3>Listening</h3>
    <div class="now-listening">
      <span id="trackTitle">Winter Hans — Steeped in Snow</span>
      <span id="hansNote" class="hans-note"></span>
    </div>
    <button id="hansToggle" class="hans-button">☕ Begin</button>
    <audio id="hansAudio" loop></audio>
  </aside>

</div>

<!-- Center Video Reveal -->
<div id="videoReveal" class="video-reveal">
  <video id="ambientVideo" autoplay muted loop></video>
  <button id="closeVideo" class="close-video">✕</button>
</div>

<!-- Marginalia -->
<div id="marginalia" class="marginalia"></div>
<div class="marginalia-input">
  <input type="text" id="noteInput" placeholder="Leave a thought..." maxlength="100" />
  <button id="submitNote">✎</button>
</div>

<script>
// Audio & Hans responses
const audio = document.getElementById("hansAudio");
const toggle = document.getElementById("hansToggle");
const trackTitle = document.getElementById("trackTitle");
const hansNote = document.getElementById("hansNote");

let listening = false;
let currentMood = "winter";

const tracks = {
  winter: {
    title: "Winter Hans — Steeped in Snow",
    file: "https://xenbohem.github.io/chimeraescape/audio/Hans-Songs/Lent-3.mp3",
    video: "videos/winter.mp4",
    responses: ["This one prefers patience.", "Winter does not like to be rushed.", "Yes… this will do."]
  },
   evening: {
    title: "Noon Tea",
    file: "Unchained-Hans.mp3",
    video: "video1.mp4",
    responses: ["A softer choice.", "Good. The day is finished."]
  },
  evening: {
    title: "Evening Service",
    file: "https://xenbohem.github.io/chimeraescape/audio/Hans-Songs/Properly-Steeped-Hanz.mp3",
    video: "video1.mp4",
    responses: ["A softer choice.", "Good. The day is finished."]
  },
  quiet: {
    title: "After the Last Reader Leaves",
    file: "https://xenbohem.github.io/chimeraescape/audio/Hans-Songs/Properly-steeped.mp3",
    video: "videos/quiet.mp4",
    responses: ["Few stay this late.", "Poetry requires space."]
  }
};

// Center Video
const videoReveal = document.getElementById("videoReveal");
const ambientVideo = document.getElementById("ambientVideo");
const closeVideo = document.getElementById("closeVideo");
closeVideo.addEventListener("click", () => videoReveal.classList.remove("active"));

// Marginalia
const marginalia = document.getElementById("marginalia");
const noteInput = document.getElementById("noteInput");
const submitNote = document.getElementById("submitNote");
function addNote(text) {
  const note = document.createElement("div");
  note.className = "marginalia-note";
  note.textContent = text;
  note.style.left = Math.random()*90 + "%";
  marginalia.appendChild(note);
  setTimeout(() => marginalia.removeChild(note), 12000);
}
submitNote.addEventListener("click", () => {
  if(noteInput.value.trim()!=="") { addNote(noteInput.value.trim()); noteInput.value=""; }
});
noteInput.addEventListener("keydown", e => { if(e.key==="Enter") submitNote.click(); });


// Begin / Hold
toggle.addEventListener("click", () => {
  if(!listening){ audio.play(); toggle.textContent="❄ Hold"; listening=true; }
  else{ audio.pause(); toggle.textContent="☕ Begin"; listening=false; }
});

// Set Mood (track + video + Hans response)
function setMood(mood){
  if(mood===currentMood) return;
  currentMood=mood;
  audio.src=tracks[mood].file;
  trackTitle.textContent=tracks[mood].title;
  hansNote.textContent=tracks[mood].responses[Math.floor(Math.random()*tracks[mood].responses.length)];
  ambientVideo.src=tracks[mood].video;
  videoReveal.classList.add("active");
  if(listening) audio.play();
}

// Book buttons
document.querySelectorAll(".book-category").forEach(btn=>{
  btn.addEventListener("click",()=>{ setMood(btn.dataset.mood); });
});
</script>
</body>
</html>
