<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hans’ Listening Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg-indigo: #0f0b24;
  --panel-purple: rgba(60,40,110,0.45);
  --lavender: #e7dcff;
  --cornflower: rgba(100,149,237,0.6);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #1b1440, var(--bg-indigo));
  color: var(--lavender);
  font-family: Georgia, serif;
  height: 100vh;
  overflow: hidden;
}

/* Layout */
.app {
  display: grid;
  grid-template-columns: 260px 1fr 300px;
  height: 100%;
}

.drawer {
  padding: 20px;
  background: var(--panel-purple);
  backdrop-filter: blur(18px);
}

/* Buttons */
button {
  width: 100%;
  margin-top: 12px;
  padding: 10px;
  border-radius: 14px;
  border: none;
  background: rgba(180,150,255,0.2);
  color: var(--lavender);
  cursor: pointer;
}
button:hover { box-shadow: 0 0 14px var(--cornflower); }

/* Center */
.center {
  padding: 40px;
}

/* Listening */
.now-listening {
  margin-top: 20px;
  padding: 14px;
  border-radius: 16px;
  background: rgba(100,80,160,0.25);
  box-shadow: 0 0 12px rgba(160,130,255,0.3);
  transition: box-shadow 0.1s ease;
}

/* Video */
.video {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(10,10,30,0.6);
  backdrop-filter: blur(18px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
  z-index: 1000;
}
.video.active { opacity: 1; pointer-events: auto; }
.video video {
  width: 70%;
  border-radius: 20px;
}

/* Manuscript */
.manuscript {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease;
  z-index: 1100;
}
.manuscript.active { opacity: 1; }

.manuscript-inner {
  max-width: 520px;
  padding: 36px;
  background: rgba(20,15,40,0.55);
  backdrop-filter: blur(22px);
  border-radius: 22px;
  line-height: 1.8;
}

.manuscript-line {
  opacity: 0;
  animation: reveal 2.5s ease forwards;
  margin-bottom: 14px;
}
.manuscript {
  pointer-events: none; /* allows interaction underneath */
}

.manuscript-inner {
  pointer-events: auto; /* but content itself can be clicked */
  position: relative;
}
  .close-manuscript {
  position: absolute;
  top: 12px;
  right: 12px;
  background: rgba(200,170,255,0.25);
  border: none;
  border-radius: 12px;
  color: #fff;
  cursor: pointer;
  font-size: 14px;
}


@keyframes reveal {
  to { opacity: 1; }
}

/* Marginalia */
.marginalia-note {
  position: absolute;
  color: var(--lavender);
  animation: float 12s linear forwards;
}

@keyframes float {
  from { transform: translateY(100vh); opacity: 0; }
  20% { opacity: .8; }
  to { transform: translateY(-40px); opacity: 0; }
}

.marginalia-input {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 1200;
}
</style>
</head>

<body>

<div class="app">
  <aside class="drawer">
    <h3>Library</h3>
    <button data-mood="winter">Winter Hans</button>
    <button data-mood="winterInstrumental">Instrumental</button>
  </aside>

  <main class="center">
    <h1>The Listening Room</h1>
    <p>Hans prefers restraint.</p>
  </main>

  <aside class="drawer">
    <h3>Listening</h3>
    <div class="now-listening" id="glow">
      <div id="trackTitle"></div>
      <div id="hansNote"></div>
    </div>
    <button id="playBtn">☕ Begin</button>
  </aside>
</div>

<!-- Video -->
<div class="video" id="video">
  <video id="videoEl" loop muted autoplay></video>
</div>

<!-- Manuscript -->
<div class="manuscript" id="manuscript">
  <button id="closeManuscript" class="close-manuscript">✕</button>
  <div class="manuscript-inner" id="manuscriptText"></div>
</div>

<!-- Marginalia -->
<div class="marginalia-input">
  <input id="noteInput" placeholder="Leave a thought…" />
  <button id="noteBtn">✎</button>
</div>

<audio id="audio"></audio>

<script>
/* DATA */
  const tracks = {
  winter: {
    title: "Unchained, Still Warm",
    file: "winter-hans-unchained.mp3",
    video: "videos/winter.mp4",
    vocal: true,
    lyrics: [
      "I carried night inside my chest",
      "Until You spoke my name once more",
      "The dark was torn from marrow-deep",
      "Peace arrived without a sound",
      "The tea is warm",
      "And I am not who I was"
    ],
    responses: ["Freedom does not announce itself."]
  },

  winterInstrumental: {
    title: "After the Chains (Instrumental)",
    file: "winter-hans-unchained-instrumental.mp3",
    video: "videos/winter.mp4",
    vocal: false,
    responses: ["No words are required."]
  }
};

/* ELEMENTS */
const audio = document.getElementById("audio");
const video = document.getElementById("video");
const videoEl = document.getElementById("videoEl");
const trackTitle = document.getElementById("trackTitle");
const hansNote = document.getElementById("hansNote");
const manuscript = document.getElementById("manuscript");
const manuscriptText = document.getElementById("manuscriptText");
const glow = document.getElementById("glow");

let current;
  }
  document.getElementById("closeManuscript").onclick = () => {
  manuscript.classList.remove("active");
};
  /* SET MOOD */
function setMood(key) {
  const t = tracks[key];
  if (!t) return;

  audio.pause();
  audio.src = t.file;

  trackTitle.textContent = t.title;
  hansNote.textContent = t.responses[0];

  videoEl.src = t.video;
  video.classList.add("active");

  // Reset manuscript every time
  manuscript.classList.remove("active");
  manuscriptText.innerHTML = "";

  // ONLY show lyrics if vocal track
  if (t.vocal && t.lyrics) {
    t.lyrics.forEach((line, i) => {
      const d = document.createElement("div");
      d.className = "manuscript-line";
      d.style.animationDelay = `${i * 2.8}s`;
      d.textContent = line;
      manuscriptText.appendChild(d);
    });

    setTimeout(() => manuscript.classList.add("active"), 4000);
  }

  audio.play();

}

/* BUTTONS */
document.querySelectorAll("[data-mood]").forEach(b =>
  b.onclick = () => setMood(b.dataset.mood)
);

document.getElementById("playBtn").onclick = () => audio.paused ? audio.play() : audio.pause();

/* GLOW */
const ctx = new AudioContext();
const src = ctx.createMediaElementSource(audio);
const analyser = ctx.createAnalyser();
src.connect(analyser);
analyser.connect(ctx.destination);

const buf = new Uint8Array(analyser.frequencyBinCount);
function pulse() {
  analyser.getByteFrequencyData(buf);
  const avg = buf.reduce((a,b)=>a+b)/buf.length;
  glow.style.boxShadow = `0 0 ${8+avg/20}px rgba(100,149,237,.6)`;
  requestAnimationFrame(pulse);
}
audio.onplay = () => { ctx.resume(); pulse(); };

/* MARGINALIA */
const notesKey = "hansNotes";
const noteInput = document.getElementById("noteInput");
const noteBtn = document.getElementById("noteBtn");

function spawnNote(text) {
  const n = document.createElement("div");
  n.className = "marginalia-note";
  n.textContent = text;
  n.style.left = Math.random()*90+"%";
  document.body.appendChild(n);
  setTimeout(()=>n.remove(),12000);
}

noteBtn.onclick = () => {
  const t = noteInput.value.trim();
  if (!t) return;
  spawnNote(t);
  const saved = JSON.parse(localStorage.getItem(notesKey)||"[]");
  saved.push(t);
  localStorage.setItem(notesKey, JSON.stringify(saved));
  noteInput.value="";
};

(JSON.parse(localStorage.getItem(notesKey)||"[]")).forEach((n,i)=>
  setTimeout(()=>spawnNote(n),i*1200)
);
</script>

</body>
</html>

